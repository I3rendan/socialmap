<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!-- build:css styles/vendor.css -->
    <!-- bower:css -->
    <!-- endbower -->
    <!-- endbuild -->
    <!-- build:css({.tmp,app}) styles/main.css -->
    <link rel="stylesheet" href="styles/main.css">
    <!-- endbuild -->
  </head>
  <body ng-app="socialmapApp">
    <!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

    <!-- Add your site or application content here -->
    <div class="container-wrap" ng-controller="MainCtrl">
      <div class="map-wrap">
        <h1>Together, let's light up the world</h1>
        <h2>Life's better when we're connected</h2>

        <div id="map-container">

          <div id="map-inner">
            <div id="map-regions"></div>
            <div id="map-regions-US"></div>
          </div>

          <div id='wrap-explode'>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
            <div class='box'></div>
          </div>

          <div class="map-region-name">
            <p>
              <i class="icon icon-plus"></i>
              <span class="region-name">Region</span>
            </p>
          </div>

          <div class="map-pin">
            <span class="map-pin-shadow"></span>
            <i class="icon icon-location-pin"></i>
            <div class="map-pin-count">
              <p>0</p>
            </div>
          </div>
          
        </div>
      </div>
      <div class="social-wrap">

        <div class="social-outer" ng-init="loadPosts()">

          <div id="social{{$index}}" 
            class="social-item social-{{feedPost.site}}"  
            ng-repeat="feedPost in feedPosts" social-item>
            <div class="social-inner">
              <div class="social-img">
                <img ng-src="{{feedPost.avatar_url}}">
              </div>
              <div class="social-name">
                <p>
                  {{feedPost.screen_name}}
                  <span>{{feedPost.name}}</span>
                </p>
              </div>
              <div class="social-post">
                <p>{{feedPost.title}}</p>
              </div>
              <div class="social-icon">
                <i class="icon icon-{{feedPost.site}}"></i>
              </div>
            </div>
          </div>

        </div>

        <div class="social-bottom" ng-init="loadPolls()">

          <div id="poll{{$index}}"
            class="poll-item poll-{{pollItem.type}}"
            ng-class="{'active': pollCount === $index}"
            ng-repeat="pollItem in pollItems" poll-item-dir>

            <div ng-if="pollItem.type === 'gif'">
              <img ng-src="{{pollItem.url}}">
            </div>

            <div ng-if="pollItem.type === 'poll'">
              <h3>What do you think?</h3>
              <div class="poll-chart-wrap">
                <p class="poll-question">
                  {{pollItem.text}}
                </p>
                <div class="google-chart" google-chart chart="chartObject"></div>
              </div>
            </div>

          </div>

        </div>

      </div>
    </div>

    <!-- Google Analytics: change UA-XXXXX-X to be your site's ID -->
     <script>
       // (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       // (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       // m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       // })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

       // ga('create', 'UA-XXXXX-X');
       // ga('send', 'pageview');
    </script>

    <!--[if lt IE 9]>
    <script src="bower_components/es5-shim/es5-shim.js"></script>
    <script src="bower_components/json3/lib/json3.min.js"></script>
    <![endif]-->

    <!-- build:js scripts/vendor.js -->
    <!-- bower:js -->
    <script src="bower_components/jquery/dist/jquery.js"></script>
    <script src="bower_components/angular/angular.js"></script>
    <script src="bower_components/angular-cookies/angular-cookies.js"></script>
    <script src="bower_components/angular-google-chart/ng-google-chart.js"></script>
    <script src="bower_components/angular-resource/angular-resource.js"></script>
    <script src="bower_components/angular-route/angular-route.js"></script>
    <script src="bower_components/angular-sanitize/angular-sanitize.js"></script>
    <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/affix.js"></script>
    <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/alert.js"></script>
    <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/button.js"></script>
    <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/carousel.js"></script>
    <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/collapse.js"></script>
    <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/dropdown.js"></script>
    <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/tab.js"></script>
    <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/transition.js"></script>
    <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/scrollspy.js"></script>
    <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/modal.js"></script>
    <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/tooltip.js"></script>
    <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/popover.js"></script>
    <script src="bower_components/underscore/underscore.js"></script>
    <!-- endbower -->
    <!-- endbuild -->

    <!-- build:js({.tmp,app}) scripts/scripts.js -->
    <script src="scripts/app.js"></script>
    <script src="scripts/controllers/main.js"></script>
    <!-- endbuild -->

    <script type="text/javascript" src="//www.google.com/jsapi"></script>
    <script type="text/javascript">

        var currData = [];
        var prevData = [];
        var regionNew = [];

        var options = {
            backgroundColor: 'transparent',
            datalessRegionColor: '#d1c9c0',
            keepAspectRatio: false,
            width: '100%',
            height: '100%',
            colorAxis: {
                colors: ['#83c6fb','#3153d9','#011669'],
                minValue: 1,
                maxValue: 100
            },
            sizeAxis: {minValue: 0, maxValue: 100},
            legend: 'none'
        };

        var optionsUS = {
            region: 'US',
            resolution: 'provinces',
            backgroundColor: 'transparent',
            datalessRegionColor: '#d1c9c0',
            keepAspectRatio: false,
            width: '100%',
            height: '100%',
            colorAxis: {
                colors: ['#83c6fb','#3153d9','#011669'],
                minValue: 1,
                maxValue: 100
            },
            sizeAxis: {minValue: 0, maxValue: 100},
            legend: 'none'
        }

        var data;
        var dataUS;
        var chart;
        var chartUS;
        var mapTimeout;

        var init = true;
        var isUS = false;
        var partyOn = false;
        var hasMulti = false;

        var animateSpeed = 750;
        var timeoutSpeed = 3000;

        function drawRegionsMap(){
            regionArray = [['Country','Total']];
            data = google.visualization.arrayToDataTable(regionArray);
            chart = new google.visualization.GeoChart(document.getElementById('map-regions'));
            chart.draw(data, options);

            chartUS = new google.visualization.GeoChart(document.getElementById('map-regions-US'));
            chartUS.draw(data, optionsUS);

            startMap();
        }

        function startMap(){
            mapTimeout = setTimeout(drawMapData, timeoutSpeed);
        }

        function restoreMap(){

          $('#map-inner').delay(timeoutSpeed / 1.5).animate({
            opacity: 0
          }, animateSpeed, function(){

            $('#wrap-explode').removeClass('explode');
            data = google.visualization.arrayToDataTable(regionArray);
            chart = new google.visualization.GeoChart(document.getElementById('map-regions'));
            chart.draw(data, options);

            chartUS = new google.visualization.GeoChart(document.getElementById('map-regions-US'));
            chartUS.draw(data, optionsUS);

            partyOn = false;
            animateIn(false);
          });
        }

        function animateIn(isFirst){

          $('#map-container').removeClass('zoomedPre');
          $('#map-container').addClass('zoomed');

          if (hasMulti === true){

            if (regionNew.length > 1){
              partyOn = true;
              hasMulti = true;
            } else {
              partyOn = false;
              hasMulti = false;
            }

            $('#map-inner').delay(animateSpeed / 3).animate({
              opacity: 1
            }, animateSpeed, function(){
              $('#wrap-explode').addClass('explode');
              setTimeout(animateOut, timeoutSpeed);
            });
          }
          else if (isFirst === true && hasMulti === false){

            $('#map-inner').delay(animateSpeed / 3).animate({
              opacity: 1,
              fill: '#ffffff'
            }, animateSpeed, function(){
              $('#wrap-explode').addClass('explode');
              restoreMap();
            });
          } else {

            $('#map-container').removeClass('zoomed');
            $('#map-container').removeClass('usa');

            $('#map-inner').delay(animateSpeed / 3).animate({
              opacity: 1
            }, animateSpeed, function(){
              startMap();
            });
          }
        }

        var isoCountries = {
          'AF' : 'Afghanistan',
          'AX' : 'Aland Islands',
          'AL' : 'Albania',
          'DZ' : 'Algeria',
          'AS' : 'American Samoa',
          'AD' : 'Andorra',
          'AO' : 'Angola',
          'AI' : 'Anguilla',
          'AQ' : 'Antarctica',
          'AG' : 'Antigua And Barbuda',
          'AR' : 'Argentina',
          'AM' : 'Armenia',
          'AW' : 'Aruba',
          'AU' : 'Australia',
          'AT' : 'Austria',
          'AZ' : 'Azerbaijan',
          'BS' : 'Bahamas',
          'BH' : 'Bahrain',
          'BD' : 'Bangladesh',
          'BB' : 'Barbados',
          'BY' : 'Belarus',
          'BE' : 'Belgium',
          'BZ' : 'Belize',
          'BJ' : 'Benin',
          'BM' : 'Bermuda',
          'BT' : 'Bhutan',
          'BO' : 'Bolivia',
          'BA' : 'Bosnia And Herzegovina',
          'BW' : 'Botswana',
          'BV' : 'Bouvet Island',
          'BR' : 'Brazil',
          'IO' : 'British Indian Ocean Territory',
          'BN' : 'Brunei Darussalam',
          'BG' : 'Bulgaria',
          'BF' : 'Burkina Faso',
          'BI' : 'Burundi',
          'KH' : 'Cambodia',
          'CM' : 'Cameroon',
          'CA' : 'Canada',
          'CV' : 'Cape Verde',
          'KY' : 'Cayman Islands',
          'CF' : 'Central African Republic',
          'TD' : 'Chad',
          'CL' : 'Chile',
          'CN' : 'China',
          'CX' : 'Christmas Island',
          'CC' : 'Cocos (Keeling) Islands',
          'CO' : 'Colombia',
          'KM' : 'Comoros',
          'CG' : 'Congo',
          'CD' : 'Congo, Democratic Republic',
          'CK' : 'Cook Islands',
          'CR' : 'Costa Rica',
          'CI' : 'Cote D\'Ivoire',
          'HR' : 'Croatia',
          'CU' : 'Cuba',
          'CY' : 'Cyprus',
          'CZ' : 'Czech Republic',
          'DK' : 'Denmark',
          'DJ' : 'Djibouti',
          'DM' : 'Dominica',
          'DO' : 'Dominican Republic',
          'EC' : 'Ecuador',
          'EG' : 'Egypt',
          'SV' : 'El Salvador',
          'GQ' : 'Equatorial Guinea',
          'ER' : 'Eritrea',
          'EE' : 'Estonia',
          'ET' : 'Ethiopia',
          'FK' : 'Falkland Islands (Malvinas)',
          'FO' : 'Faroe Islands',
          'FJ' : 'Fiji',
          'FI' : 'Finland',
          'FR' : 'France',
          'GF' : 'French Guiana',
          'PF' : 'French Polynesia',
          'TF' : 'French Southern Territories',
          'GA' : 'Gabon',
          'GM' : 'Gambia',
          'GE' : 'Georgia',
          'DE' : 'Germany',
          'GH' : 'Ghana',
          'GI' : 'Gibraltar',
          'GR' : 'Greece',
          'GL' : 'Greenland',
          'GD' : 'Grenada',
          'GP' : 'Guadeloupe',
          'GU' : 'Guam',
          'GT' : 'Guatemala',
          'GG' : 'Guernsey',
          'GN' : 'Guinea',
          'GW' : 'Guinea-Bissau',
          'GY' : 'Guyana',
          'HT' : 'Haiti',
          'HM' : 'Heard Island & Mcdonald Islands',
          'VA' : 'Holy See (Vatican City State)',
          'HN' : 'Honduras',
          'HK' : 'Hong Kong',
          'HU' : 'Hungary',
          'IS' : 'Iceland',
          'IN' : 'India',
          'ID' : 'Indonesia',
          'IR' : 'Iran, Islamic Republic Of',
          'IQ' : 'Iraq',
          'IE' : 'Ireland',
          'IM' : 'Isle Of Man',
          'IL' : 'Israel',
          'IT' : 'Italy',
          'JM' : 'Jamaica',
          'JP' : 'Japan',
          'JE' : 'Jersey',
          'JO' : 'Jordan',
          'KZ' : 'Kazakhstan',
          'KE' : 'Kenya',
          'KI' : 'Kiribati',
          'KR' : 'Korea',
          'KW' : 'Kuwait',
          'KG' : 'Kyrgyzstan',
          'LA' : 'Lao People\'s Democratic Republic',
          'LV' : 'Latvia',
          'LB' : 'Lebanon',
          'LS' : 'Lesotho',
          'LR' : 'Liberia',
          'LY' : 'Libyan Arab Jamahiriya',
          'LI' : 'Liechtenstein',
          'LT' : 'Lithuania',
          'LU' : 'Luxembourg',
          'MO' : 'Macao',
          'MK' : 'Macedonia',
          'MG' : 'Madagascar',
          'MW' : 'Malawi',
          'MY' : 'Malaysia',
          'MV' : 'Maldives',
          'ML' : 'Mali',
          'MT' : 'Malta',
          'MH' : 'Marshall Islands',
          'MQ' : 'Martinique',
          'MR' : 'Mauritania',
          'MU' : 'Mauritius',
          'YT' : 'Mayotte',
          'MX' : 'Mexico',
          'FM' : 'Micronesia, Federated States Of',
          'MD' : 'Moldova',
          'MC' : 'Monaco',
          'MN' : 'Mongolia',
          'ME' : 'Montenegro',
          'MS' : 'Montserrat',
          'MA' : 'Morocco',
          'MZ' : 'Mozambique',
          'MM' : 'Myanmar',
          'NA' : 'Namibia',
          'NR' : 'Nauru',
          'NP' : 'Nepal',
          'NL' : 'Netherlands',
          'AN' : 'Netherlands Antilles',
          'NC' : 'New Caledonia',
          'NZ' : 'New Zealand',
          'NI' : 'Nicaragua',
          'NE' : 'Niger',
          'NG' : 'Nigeria',
          'NU' : 'Niue',
          'NF' : 'Norfolk Island',
          'MP' : 'Northern Mariana Islands',
          'NO' : 'Norway',
          'OM' : 'Oman',
          'PK' : 'Pakistan',
          'PW' : 'Palau',
          'PS' : 'Palestinian Territory, Occupied',
          'PA' : 'Panama',
          'PG' : 'Papua New Guinea',
          'PY' : 'Paraguay',
          'PE' : 'Peru',
          'PH' : 'Philippines',
          'PN' : 'Pitcairn',
          'PL' : 'Poland',
          'PT' : 'Portugal',
          'PR' : 'Puerto Rico',
          'QA' : 'Qatar',
          'RE' : 'Reunion',
          'RO' : 'Romania',
          'RU' : 'Russian Federation',
          'RW' : 'Rwanda',
          'BL' : 'Saint Barthelemy',
          'SH' : 'Saint Helena',
          'KN' : 'Saint Kitts And Nevis',
          'LC' : 'Saint Lucia',
          'MF' : 'Saint Martin',
          'PM' : 'Saint Pierre And Miquelon',
          'VC' : 'Saint Vincent And Grenadines',
          'WS' : 'Samoa',
          'SM' : 'San Marino',
          'ST' : 'Sao Tome And Principe',
          'SA' : 'Saudi Arabia',
          'SN' : 'Senegal',
          'RS' : 'Serbia',
          'SC' : 'Seychelles',
          'SL' : 'Sierra Leone',
          'SG' : 'Singapore',
          'SK' : 'Slovakia',
          'SI' : 'Slovenia',
          'SB' : 'Solomon Islands',
          'SO' : 'Somalia',
          'ZA' : 'South Africa',
          'GS' : 'South Georgia And Sandwich Isl.',
          'ES' : 'Spain',
          'LK' : 'Sri Lanka',
          'SD' : 'Sudan',
          'SR' : 'Suriname',
          'SJ' : 'Svalbard And Jan Mayen',
          'SZ' : 'Swaziland',
          'SE' : 'Sweden',
          'CH' : 'Switzerland',
          'SY' : 'Syrian Arab Republic',
          'TW' : 'Taiwan',
          'TJ' : 'Tajikistan',
          'TZ' : 'Tanzania',
          'TH' : 'Thailand',
          'TL' : 'Timor-Leste',
          'TG' : 'Togo',
          'TK' : 'Tokelau',
          'TO' : 'Tonga',
          'TT' : 'Trinidad And Tobago',
          'TN' : 'Tunisia',
          'TR' : 'Turkey',
          'TM' : 'Turkmenistan',
          'TC' : 'Turks And Caicos Islands',
          'TV' : 'Tuvalu',
          'UG' : 'Uganda',
          'UA' : 'Ukraine',
          'AE' : 'United Arab Emirates',
          'GB' : 'United Kingdom',
          'US' : 'United States',
          'UM' : 'United States Outlying Islands',
          'UY' : 'Uruguay',
          'UZ' : 'Uzbekistan',
          'VU' : 'Vanuatu',
          'VE' : 'Venezuela',
          'VN' : 'Viet Nam',
          'VG' : 'Virgin Islands, British',
          'VI' : 'Virgin Islands, U.S.',
          'WF' : 'Wallis And Futuna',
          'EH' : 'Western Sahara',
          'YE' : 'Yemen',
          'ZM' : 'Zambia',
          'ZW' : 'Zimbabwe'
        };

        var usStates = {
          'AK': 'Alaska',
          'AL': 'Alabama',
          'AR': 'Arkansas',
          'AS': 'American Samoa',
          'AZ': 'Arizona',
          'CA': 'California',
          'CO': 'Colorado',
          'CT': 'Connecticut',
          'DC': 'District of Columbia',
          'DE': 'Delaware',
          'FL': 'Florida',
          'GA': 'Georgia',
          'GU': 'Guam',
          'HI': 'Hawaii',
          'IA': 'Iowa',
          'ID': 'Idaho',
          'IL': 'Illinois',
          'IN': 'Indiana',
          'KS': 'Kansas',
          'KY': 'Kentucky',
          'LA': 'Louisiana',
          'MA': 'Massachusetts',
          'MD': 'Maryland',
          'ME': 'Maine',
          'MI': 'Michigan',
          'MN': 'Minnesota',
          'MO': 'Missouri',
          'MP': 'Northern Mariana Islands',
          'MS': 'Mississippi',
          'MT': 'Montana',
          'NA': 'National',
          'NC': 'North Carolina',
          'ND': 'North Dakota',
          'NE': 'Nebraska',
          'NH': 'New Hampshire',
          'NJ': 'New Jersey',
          'NM': 'New Mexico',
          'NV': 'Nevada',
          'NY': 'New York',
          'OH': 'Ohio',
          'OK': 'Oklahoma',
          'OR': 'Oregon',
          'PA': 'Pennsylvania',
          'PR': 'Puerto Rico',
          'RI': 'Rhode Island',
          'SC': 'South Carolina',
          'SD': 'South Dakota',
          'TN': 'Tennessee',
          'TX': 'Texas',
          'UT': 'Utah',
          'VA': 'Virginia',
          'VI': 'Virgin Islands',
          'VT': 'Vermont',
          'WA': 'Washington',
          'WI': 'Wisconsin',
          'WV': 'West Virginia',
          'WY': 'Wyoming'
        }

        function getCountryName(countryCode) {
            if (isoCountries.hasOwnProperty(countryCode)) {
                return isoCountries[countryCode];
            } else {
                return countryCode;
            }
        }

        function getStateName(stateCode) {
            if (usStates.hasOwnProperty(stateCode)) {
                return usStates[stateCode];
            } else {
                return stateCode;
            }
        }

        function commaSeparateNumber(val){
          while (/(\d+)(\d{3})/.test(val.toString())){
            val = val.toString().replace(/(\d+)(\d{3})/, '$1'+','+'$2');
          }
          return val;
        }

        function animateOut(){

          $('#wrap-explode').removeClass('explode');
          $('#map-container').addClass('zoomedPre');
          $('#map-inner').animate({
            opacity: 0
          }, animateSpeed, function(){

            data = google.visualization.arrayToDataTable(regionArray);
            
            var tempCount = commaSeparateNumber(regionNew[0][1]);
            $('.map-pin-count').html('<p>'+tempCount+'</p>');

            if (regionNew[0][0].indexOf('US-') !== -1){

              isUS = true;

              if (regionNew[0][0].indexOf('US-AK') !== -1){
                $('#map-regions-US svg g[clip-path] > g g:nth-child(2)').css('display','block');
              } else {
                $('#map-regions-US svg g[clip-path] > g g:nth-child(2)').css('display','none');
              }

              if (regionNew[0][0].indexOf('US-HI') !== -1){
                $('#map-regions-US svg g[clip-path] > g g:nth-child(3)').css('display','block');
              } else {
                $('#map-regions-US svg g[clip-path] > g g:nth-child(3)').css('display','none');
              }

              var tempState = regionNew[0][0].replace('US-','');
              $('.region-name').html(getStateName(tempState));
              $('#map-container').addClass('usa');

              var optionsSpecUS = {
                backgroundColor: 'transparent',
                datalessRegionColor: '#d1c9c0',
                colorAxis: {
                    colors: ['#83c6fb','#3153d9','#011669'],
                    minValue: 1,
                    maxValue: 100
                },
                keepAspectRatio: false,
                width: '100%',
                height: '100%',
                sizeAxis: {minValue: 0, maxValue: 100},
                legend: 'none',
                region: regionNew[0][0],
                resolution: 'provinces'
              }

              chartUS = new google.visualization.GeoChart(document.getElementById('map-regions-US')); 
              chartUS.draw(data, optionsSpecUS);

            } else {

              isUS = false;

              $('#map-regions-US svg g[clip-path] > g g:nth-child(2)').css('display','none');
              $('#map-regions-US svg g[clip-path] > g g:nth-child(3)').css('display','none');

              $('.region-name').html(getCountryName(regionNew[0][0]));
              $('#map-container').removeClass('usa');

              var optionsSpec = {
                backgroundColor: 'transparent',
                datalessRegionColor: '#d1c9c0',
                colorAxis: {
                    colors: ['#83c6fb','#3153d9','#011669'],
                    minValue: 0,
                    maxValue: 100
                },
                keepAspectRatio: false,
                width: '100%',
                height: '100%',
                sizeAxis: {minValue: 0, maxValue: 100},
                legend: 'none',
                region: regionNew[0][0]
              }

              chart = new google.visualization.GeoChart(document.getElementById('map-regions'));
              chart.draw(data, optionsSpec);
            }

            if (regionNew.length <= 1){
              isMulti = false;
              animateIn(true);
            } else {
              regionNew.shift();
              animateIn(false);
            }

          });
        }

        var tempNewRegion;

        function drawMapData(){
          $.ajax({
              url: '/app/allmapdata', 
              //url: '/feeds/mapData.json', 
              dataType: 'json',
              cache: false
          })
          .success(function(data){

              prevData = currData;
              currData = data;
              regionNew = [];
              regionArray = [['Country','Total']];

              _.each(data, function(item){
                
                tempNewRegion = true;

                  _.each(prevData, function(prevItem){
                      if (prevItem.country === item.country && prevItem.total !== item.total){
                          regionNew.push([item.country,item.total]);
                          partyOn = true;
                      }

                      if (prevItem.country === item.country){
                        tempNewRegion = false;
                      }

                  });

                  if (tempNewRegion === true && init === false){
                    regionNew.push([item.country,item.total]);
                    partyOn = true;
                  }

                  regionArray.push([item.country,Number(item.total)]);              
              });

              if (regionNew.length > 1){
                hasMulti = true;
              } else {
                hasMulti = false;
              }

              if (init === false && partyOn === true){
                  clearTimeout(mapTimeout);
                  animateOut();
              } else if (init === false && partyOn === false){
                  startMap();
              } else if (init === true){
                data = google.visualization.arrayToDataTable(regionArray);
                chart = new google.visualization.GeoChart(document.getElementById('map-regions'));
                chart.draw(data, options);

                chartUS = new google.visualization.GeoChart(document.getElementById('map-regions-US'));
                chartUS.draw(data, optionsUS);

                init = false;
                startMap();
              }
          })
          .error(function(){
              console.log('Error loading JSON');
              startMap();
          });
      }

      google.load('visualization', '1', {packages:['geochart']});
      google.setOnLoadCallback(drawRegionsMap);
    </script>
    
</body>
</html>